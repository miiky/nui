Nui.define('src/components/layer/layer',['component','util','template'],function(t,e,i){var n={_maskzIndex:1e4,_zIndex:1e4,_init:function(){var t=this,e=null;Nui.win.on('resize',function(){clearTimeout(e),e=setTimeout(function(){Nui.each(t.__instances,function(t){var e=t._options;(e.position||!0===e.isCenter)&&t.resize()})})})},_$fn:null,_$ready:null,init:null},o={content:'',template:'',data:{},width:320,height:'auto',zIndex:null,maxWidth:0,maxHeight:0,timer:0,edge:0,container:'body',title:'温馨提示',isMove:!1,isMask:!0,isInnerMove:!1,isClickMask:!1,isMoveMask:!1,isHide:!0,isCenter:!0,isFull:!1,isTop:!1,isTips:!1,isFixed:!0,scrollbar:!0,isStopProp:!1,align:'center',bubble:{enable:!1,dir:'top'},iframe:{enable:!1,cache:!1,src:''},close:{enable:!0,text:'×'},confirm:{enable:!1,name:'normal',text:'确定',callback:function(){return!0}},cancel:{enable:!0,text:'取消'},position:null,under:null,button:null,onMove:null,onResize:null,onScroll:null,onHideBefore:null,onDestroyBefore:null,onTimer:null};return this.extend(t,{_static:n,_options:o,_template:{layout:'<div class="<% className %>" style="<% include \'style\' %>"><div class="layer-box"><%if close%><% var btn = close %><% include "button" %><%/if%><%if bubble%><span class="layer-bubble layer-bubble-<%bubble.dir||"top"%>"<%if bubble.style%> style="<%each bubble.style v n%><%n%>:<%v%>;<%/each%>"<%/if%>><b></b><i></i></span><%/if%><%if title%><div class="layer-head"><span class="layer-title"><%title%></span></div><%/if%><div class="layer-body"><div class="layer-main"><%content%></div></div><%if button && button.length%><div class="layer-foot" style="text-align:<%align%>"><div class="layer-inner"><%each button btn%><%include "button"%><%/each%></div></div><%/if%></div></div>',button:'<button class="ui-button<%if btn.name%><%each [].concat(btn.name) name%> ui-button-<%name%><%/each%><%/if%> layer-button-<%btn.id%>"<%if btn.style%> style="<%each btn.style v n%><%n%>:<%v%>;<%/each%>"<%/if%>><%btn.text || "按钮"%></button>',iframe:'<iframe<%each attr%> <%$index%>="<%$value%>"<%/each%>></iframe>',mask:'<div class="nui-layer-mask<%if skin%> nui-layer-mask-<%skin%><%/if%>" style="<%include \'style\'%>"><div class="layer-mask"></div></div>',movemask:'<div class="nui-layer-movemask<%if skin%> nui-layer-movemask-<%skin%><%/if%>" style="<%include \'style\'%>"></div>',style:'<%each style%><%$index%>:<%$value%>;<%/each%>'},data:{},_init:function(){this._zIndex=++this.constructor._zIndex,this._exec()},_exec:function(){var t=this,e=t._options,i=t.constructor;if(t._container=i._jquery(e.container),t._container.length){if(t._containerDOM=t._container.get(0),'BODY'!==t._containerDOM.tagName){t._window=t._container,t._isWindow=!1;-1==='absolute relative fixed'.indexOf(t._container.css('position'))&&t._container.css('position','relative')}else t._window=Nui.win,t._isWindow=!0;t._isFixed=e.isFixed&&!Nui.bsie6&&t._isWindow,t._create()}},_create:function(){var t=this,e=t._options,i=t._createButton(),n=!1;!0!==e.isTips&&(n='string'==typeof e.title);var o=t._tplData({content:t._getContent(),close:i.close,button:i.button,title:n?e.title||'温馨提示':null,bubble:!0===e.bubble.enable?e.bubble:null,align:e.align||'center',style:{'z-index':isNaN(parseInt(e.zIndex))?t._zIndex:e.zIndex,'position':'absolute','display':'block'}});t._isFixed&&(o.style.position='fixed'),t._setTop(),t.element=t._bindComponentName($(t._tpl2html('layout',o)).appendTo(t._container)),t._box=t.element.children('.layer-box'),t.head=t._box.children('.layer-head'),t._body=t._box.children('.layer-body'),t.main=t._body.children('.layer-main'),t.foot=t._box.children('.layer-foot'),!0!==e.isTips&&(!0===e.iframe.enable&&(t._iframe=t.main.children('iframe'),t._iframeOnload()),!0===e.isMove&&n&&t._bindMove(),!0===e.isStopProp&&t._stopProp(),!0===e.isTop&&t._bindTop()),t._button.length&&t._buttonEvent(),!0===e.isFixed&&!0==!t._isFixed&&t._bindScroll(),t._event(),t._show()},_getContent:function(){var t=this,e=t._options,n='',o=e.template;return!0!==e.isTips&&!0===e.iframe.enable?n=t._createIframe():o?'string'==typeof o?n=i.render(o,e.data):Nui.type(e.template,'Object')&&(n=i.render.call(o,o.main,e.data)):'string'==typeof e.content?n=e.content:e.content instanceof jQuery&&(n=e.content.prop('outerHTML')),n},_createIframe:function(){var t=this,i=t._options,n='layer-iframe'+t.__id,o=i.iframe.src;return!1===i.iframe.cache&&(o=e.setParam('_',(new Date).getTime(),o)),t._tpl2html('iframe',{attr:{frameborder:'0',name:n,id:n,src:o,scroll:'hidden',style:'width:100%;'}})},_iframeOnload:function(){var t=this;t._iframe.load(function(){t._iframeDocument=t._iframe.contents(),t._resize()})},_createButton:function(){var t=this,e=t._options,i={},n={},o={},a=function(e,i){t._button['close'===e?'unshift':'push'](i)};return t._button=[],!0!==e.isTips&&(Nui.each(['close','confirm','cancel'],function(t){var n=e[t];n&&!0===n.enable&&(i[t]={id:t,name:n.name,style:n.style,text:n.text,callback:n.callback})}),e.button&&e.button.length&&Nui.each(e.button,function(t){var e,n=t.id,s=t;o[n]||(o[n]=!0,(e=i[n])&&(s=$.extend(!0,{},e,t),delete i[n]),a(n,s))}),Nui.each(i,function(t,e){a(e,t)})),t._button[0]&&'close'===t._button[0].id?(n.close=t._button[0],n.button=t._button.slice(1)):n.button=t._button,n},_buttonEvent:function(){var t=this,e=t._options;Nui.each(t._button,function(i){t._on('click',t.element,'.layer-button-'+i.id,function(n,o){if(!o.hasClass('nui-button-disabled')){var a=i.id,s=i.callback,l='function'==typeof s?s.call(e,t,n,o):null;('confirm'===a&&!0===l||'confirm'!==a&&!1!==l)&&t.destroy()}})})},_stopProp:function(){this._on('click',this.element,function(t){t.stopPropagation()})},_bindTop:function(){var t=this;t._on('click',t.element,function(){t._setzIndex()})},_bindMove:function(){var t,e,i,n,o=this,a=o._options,s=o.element,l=o.constructor,r=s,c=!1;o._on('mousedown',o.head,function(i,n){c=!0,o._setzIndex(),!0===a.isMoveMask&&(r=o._moveMask=$(o._tpl2html('movemask',{skin:a.skin,style:{'z-index':o._zIndex+1,'cursor':'move','position':o._isFixed?'fixed':'absolute'}})).appendTo(o._container),r.css({width:o.data.outerWidth-l._getSize(r,'lr','all'),height:o.data.outerHeight-l._getSize(r,'tb','all'),top:o.data.top,left:o.data.left})),n.css('cursor','move'),t=i.pageX-o.data.left,e=i.pageY-o.data.top,i.stopPropagation()}),o._on('mousemove',Nui.doc,function(s){var l=o._container.outerWidth(),d=o._container.outerHeight();if(c)return i=s.pageX-t,n=s.pageY-e,i<0&&(i=0),n<0&&(n=0),!0===a.isInnerMove&&(i+o.data.outerWidth>l&&(i=l-o.data.outerWidth),n+o.data.outerHeight>d&&(n=d-o.data.outerHeight)),o.data.top=n,o.data.left=i,r.css({top:n,left:i}),!c}),o._on('mouseup',Nui.doc,function(t){c&&(c=!1,o.head.css('cursor','default'),!0===a.isMoveMask&&(s.css(o.data),o._moveMask.remove(),o._moveMask=null),o._callback('Move'),o.data.offsetTop=o.data.top-o._window.scrollTop(),o.data.offsetLeft=o.data.left-o._window.scrollLeft())})},_bindScroll:function(){var t=this;t._options;t._on('scroll',t._window,function(e,i){var n=t.data.offsetTop+t._window.scrollTop(),o=t.data.offsetLeft+t._window.scrollLeft();t.data.top=n,t.data.left=o,t.element.css(t.data),t._callback('Scroll',[e,i,{top:n,left:o}])})},_setzIndex:function(){var t=this,e=t.constructor;t._isTop&&t.element&&(t._isTop=!1,t._zIndex=++e._zIndex,t.element.css('zIndex',t._zIndex),t._setTop())},_setLower:function(t){var e=this,i=e.constructor,n=e._options,o=[];n.under&&(o=o.concat(n.under),o.length&&Nui.each(o,function(e,n){e&&e.element&&e.element.css('z-index',t?isNaN(parseInt(e._options.zIndex))?e._zIndex:e._options.zIndex:i._maskzIndex-1)}))},_setTop:function(){var t=this,e=t.constructor;Nui.each(e.__instances,function(e){e&&e!==t&&!0===e._options.isTop&&(e._isTop=!0)})},_position:function(){var t,e=this,i=e.data,n=e._options.position,o={top:n.top,left:n.left,right:n.right,bottom:n.bottom};return void 0!==o.top&&void 0!==o.bottom&&delete o.bottom,void 0!==o.left&&void 0!==o.right&&delete o.right,Nui.each(o,function(e,n){if(void 0===e)return delete o[n],!0;t=e,'string'==typeof e&&(e?'top'===n||'bottom'===n?'self'===e?t=i.outerHeight:/[\+\-\*\/]/.test(e)&&(t=new Function('var self = '+i.outerHeight+'; return '+e)()):'self'===e?t=i.outerWidth:/[\+\-\*\/]/.test(e)&&(t=new Function('var self = '+i.outerWidth+'; return '+e)()):t=0),o[n]='auto'===t?'auto':parseFloat(t)+'px'}),o},_resize:function(t){var e=this,i=(e.constructor,e._options),n=e.element,o=e._window.outerWidth(),a=e._window.outerHeight(),s=0,l=0;if(e._isFixed||(l=e._window.scrollLeft(),s=e._window.scrollTop()),e._setSize(),i.position){var r=n.css(e._position()).position();Nui.bsie6&&(l=0,s=0),e.data.left=r.left+l,e.data.top=r.top+s}else if('init'===t||!0===i.isCenter){var c=(o-e.data.outerWidth)/2+l,d=(a-e.data.outerHeight)/2+s,_=i.edge>0?i.edge:0;e.data.left=c>0?c:_,e.data.top=d>0?d:_}e.data.offsetTop=e.data.top-e._window.scrollTop(),e.data.offsetLeft=e.data.left-e._window.scrollLeft(),n.css(e.data)},_setSize:function(){var t=this,e=t.constructor,i=t._options,n=t.element,o=i.edge>0?2*i.edge:0,a=t._window.outerWidth()-o,s=t._window.outerHeight()-o,l=i.scrollbar;t._body.css({height:'auto',overflow:'visible'}),n.css({top:'auto',left:'auto',width:'auto',height:'auto'});var r=e._getSize(t._box,'tb','all')+t.head.outerHeight()+e._getSize(t.head,'tb','margin')+e._getSize(t._body,'tb','all')+t.foot.outerHeight()+e._getSize(t.foot,'tb','margin'),c=n.outerWidth();!0!==i.isFull?(i.width>0?c=i.width:('100%'===i.width||!0===i.scrollbar&&c>a)&&(c=a),i.maxWidth>0&&c>=i.maxWidth&&(l=!0,c=i.maxWidth)):c=a;var d='nowrap';(i.width>0||c==i.maxWidth||c==a)&&(d='normal'),t.data.width=c-e._getSize(n,'lr','all'),t.main.css('white-space',d),n.width(t.data.width);var _=n.outerHeight();t._iframeDocument&&(t._iframeDocument[0].layer=t,_=r+t._iframeDocument.find('body').outerHeight()),!0!==i.isFull?(i.height>0?_=i.height:('100%'===i.height||(!0===i.scrollbar||t._iframeDocument)&&_>s)&&(_=s),i.maxHeight>0&&_>=i.maxHeight&&(l=!0,_=i.maxHeight)):_=s,t.data.outerWidth=c,t.data.outerHeight=_,t.data.height=_-e._getSize(n,'tb','all'),n.height(t.data.height);var u=t.data.height-r;t.main.outerHeight()>u&&!t._iframe&&!0===l&&t._body.css('overflow','auto'),t._iframe&&t._iframe.height(u),t._body.height(t.data.contentHeight=u)},_showMask:function(){var t=this,e=t.constructor,i=t._options;t._containerDOM.__layermask__||(t._containerDOM.__layermask__=$(t._tpl2html('mask',{skin:i.skin,style:{'z-index':e._maskzIndex,'position':t._isFixed?'fixed':'absolute','top':'0px','left':'0px','width':'100%','height':t._isFixed?'100%':t._container.outerHeight()+'px'}})).appendTo(t._container)),!0===i.isStopProp&&t._on('click',t._containerDOM.__layermask__,function(t){t.stopPropagation()}),!0===i.isClickMask&&t._on('click',t._containerDOM.__layermask__,function(){t.hide()})},_show:function(){var e=this,i=e._options;return t.init(e.main),e._resize('init'),e._setLower(),!0===i.isMask&&e._showMask(),i.timer>0&&(e._time=i.timer,e._timer()),e._callback('Init'),e},_timer:function(){var t=this;t._options;t._time>0?(t._callback('Timer',[t._time]),t._timerid=setTimeout(function(){t._time-=1e3,t._timer()},t._time>1e3?1e3:t._time)):t.hide()},_reset:function(){var e=this,i=e.constructor,n=!0;t.exports._reset.call(this),t('destroy',e.main),Nui.each(i.__instances,function(t){if(t&&!0===t._options.isMask&&t!==e&&t._containerDOM===e._containerDOM)return n=!1}),n&&e._containerDOM.__layermask__&&(e._containerDOM.__layermask__.remove(),e._containerDOM.__layermask__=null),e._options.timer>0&&(e.timer=0,clearTimeout(e._timerid))},resize:function(){var t=this;t._options,t.element;return t._resize(),t._callback('Resize'),t},hide:function(){if(!0===this._options.isHide){if(!1===this._callback('HideBefore'))return;this.destroy()}},destroy:function(){var t=this,e=t.constructor;t._options;!1!==t._callback('DestroyBefore')&&(t._delete(),t._reset(),t._setLower(!0),t._isdestroy||(e._zIndex--,t._isdestroy=!0),t._callback('Destroy'))}})}),Nui.define('./script/page',['src/components/layer/layer','events'],function(t,e){var renders=this.renders;return e({element:document,events:{'click .j-demo':function(){t({content:'<p style="padding:10px; text-align:center;">hello world</p>',width:280,height:150,cancel:{text:'关闭',callback:function(t){console.log(t)}}})},'click .j-position':function(){t({content:renders('<div style="padding:15px 20px; line-height:20px;"><p>消息标题1</p><p>消息标题2</p><p>消息标题3</p></div>'),title:'系统消息',width:280,isMask:!1,cancel:{enable:!1},position:{bottom:'self*-1',right:0},onInit:function(t){this.position.bottom=0,t.element.animate({top:t.data.top-t.data.outerHeight})}})}}})});
//# sourceMappingURL=page-min.js.map?v=55efc13